<!-- VERSION: v11.0 | EXPERIMENT 1: INPUT SIGNAL PROBE -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YZU- Stone Studio (Debug)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              game: { bg: '#0b1120', surface: '#1e293b', primary: '#06b6d4', accent: '#f43f5e', text: '#f1f5f9' }
            },
            fontFamily: { sans: ['"Rajdhani"', '"Nunito"', 'sans-serif'], mono: ['"Fira Code"', 'monospace'] }
          }
        }
      }
    </script>
    <style>
        html, body { height: 100%; width: 100%; margin: 0; background-color: #0b1120; touch-action: manipulation; }
        .app-container { height: 100vh; display: flex; flex-direction: column; }
    </style>
</head>
<body class="bg-game-bg text-game-text font-sans antialiased">
    <div class="app-container max-w-full mx-auto p-2">
        
        <!-- Header -->
        <header class="shrink-0 flex flex-col mb-4 border-b border-game-surface pb-2">
            <h1 class="text-xl font-extrabold text-game-primary font-[Rajdhani]">YZU- Stone Studio</h1>
            <p class="text-xs text-red-400 font-mono">實驗一：訊號偵測模式</p>
        </header>
        <!-- Main Upload Area -->
        <main class="flex-1 flex flex-col gap-4">
            
            <!-- 大按鈕區域 -->
            <div class="relative w-full h-48 border-2 border-dashed border-game-primary/50 rounded-xl bg-game-surface/20 flex flex-col items-center justify-center">
                <div class="pointer-events-none text-center">
                    <p class="text-xl font-bold mb-2">點擊此處上傳照片</p>
                    <p class="text-xs text-gray-400">系統將監聽 iPhone 訊號</p>
                </div>
                
                <!-- 最純粹的 Input，不隱藏，保留透明度確保可點擊 -->
                <input 
                    type="file" 
                    id="file-input" 
                    accept="image/*" 
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                    onclick="window.App.log('使用者點擊了上傳區域 (Click Detected)')"
                    onchange="window.App.handleFile(this)"
                >
            </div>
            <!-- 預覽區域 (證明圖片有讀進來) -->
            <div id="preview-area" class="hidden flex-col items-center p-4 bg-game-surface rounded-xl">
                <p class="text-xs text-green-400 mb-2">預覽圖 (若顯示代表讀取成功)</p>
                <img id="preview-img" class="max-h-48 rounded border border-gray-600">
            </div>
            <!-- 系統日誌 (Debug Console) -->
            <div class="flex-1 bg-black/80 rounded-xl p-2 font-mono text-[10px] overflow-y-auto border border-gray-700 text-green-500 shadow-inner" id="console-log">
                <div>> 系統初始化完成...</div>
                <div>> 等待使用者操作...</div>
            </div>
        </main>
    </div>
    <script>
        window.App = {
            init: function() {
                this.log("監聽器已啟動 (Listener Ready)");
                // 確保清空殘留
                document.getElementById('file-input').value = '';
            },
            // 負責寫日誌的函式
            log: function(msg) {
                const consoleDiv = document.getElementById('console-log');
                const time = new Date().toLocaleTimeString();
                const newLog = document.createElement('div');
                newLog.innerHTML = <span class="text-gray-500">[${time}]</span> ${msg};
                consoleDiv.appendChild(newLog);
                consoleDiv.scrollTop = consoleDiv.scrollHeight;
                console.log(msg); // 同步輸出到瀏覽器控制台
            },
            handleFile: function(input) {
                // 1. 先清空預覽與狀態
                this.log("------------------------------");
                this.log("偵測到狀態改變 (Change Event Triggered)");
                
                const file = input.files[0];
                
                if (!file) {
                    this.log("錯誤：沒有偵測到檔案物件 (No File)");
                    alert("錯誤：雖然觸發了動作，但沒有收到檔案。");
                    return;
                }
                // 2. 顯示檔案資訊
                const sizeKB = (file.size / 1024).toFixed(2);
                this.log(`檔案名稱: ${file.name}`);
                this.log(`檔案類型: ${file.type}`);
                this.log(`檔案大小: ${sizeKB} KB`);
                // 3. 彈出明確的成功訊息 (實驗要求)
                alert(`系統確認：已接收到照片！\n大小：${sizeKB} KB\n準備開始讀取...`);
                // 4. 嘗試讀取並顯示 (這是為了證明記憶體沒爆)
                this.log("啟動 FileReader...");
                
                const reader = new FileReader();
                
                reader.onloadstart = () => this.log("開始讀取 (Loading started)...");
                reader.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const percent = Math.round((e.loaded / e.total) * 100);
                        // 減少 log 頻率
                        if (percent % 20 === 0) this.log(`讀取進度: ${percent}%`);
                    }
                };
                reader.onload = (e) => {
                    this.log("讀取完成 (File Read Success)!");
                    
                    const img = document.getElementById('preview-img');
                    const area = document.getElementById('preview-area');
                    
                    img.onload = () => {
                        this.log(`圖片渲染成功: ${img.naturalWidth} x ${img.naturalHeight} px`);
                        alert("實驗成功：照片已顯示在畫面上！");
                    };
                    
                    img.onerror = () => {
                        this.log("錯誤：圖片渲染失敗 (Image Render Error)");
                        alert("雖然讀到了檔案，但無法顯示圖片 (可能是格式問題)");
                    };
                    img.src = e.target.result;
                    area.classList.remove('hidden');
                    area.classList.add('flex');
                };
                reader.onerror = () => {
                    this.log("致命錯誤：FileReader 無法讀取檔案");
                    alert("讀取失敗：瀏覽器拒絕存取此檔案");
                };
                // 開始讀取
                reader.readAsDataURL(file);
            }
        };
        window.App.init();
    </script>
</body>
</html>
