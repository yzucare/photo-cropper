<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    .container { width: 100%; padding: 10px; }
    .input-group { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 8px;
      margin-bottom: 15px;
    }
    input { 
      width: 80px; 
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    canvas { 
      margin-top: 10px;
      max-width: 390px;
      max-height: 300px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="input-group">
      <div><label>N=</label><input type="number" id="N" min="1"></div>
      <div><label>n=</label><input type="number" id="n" min="1"></div>
      <div><label>c=</label><input type="number" id="c" min="0"></div>
      <div><label>p=</label><input type="text" id="p" readonly></div>
    </div>
    <canvas id="ocChart"></canvas>
  </div>
  <script>
    let chart;
    const calculatePa = (p, n, c) => {
      let pa = 0;
      for(let k=0; k<=c; k++){
        pa += binomial(n, k)  Math.pow(p, k)  Math.pow(1-p, n-k);
      }
      return pa;
    };
    const binomial = (n, k) => {
      if(k < 0 || k > n) return 0;
      let coeff = 1;
      for(let x=n-k+1; x<=n; x++) coeff *= x;
      return coeff / factorial(k);
    };
    const factorial = num => {
      return num <= 1 ? 1 : num * factorial(num - 1);
    };
    const updateChart = () => {
      const N = parseInt(document.getElementById('N').value) || 0;
      const n = parseInt(document.getElementById('n').value) || 0;
      const c = parseInt(document.getElementById('c').value) || 0;
      const p = n > 0 ? c / n : 0;
      document.getElementById('p').value = p.toFixed(4);
      if(chart) chart.destroy();
      if(n === 0 || c > n) return;
      const labels = Array.from({length: 21}, (_,i) => i/20);
      const data = labels.map(p => calculatePa(p, n, c));
      chart = new Chart(document.getElementById('ocChart'), {
        type: 'line',
        data: {
          labels: labels.map(v => (v*100).toFixed(0)+'%'),
          datasets: [{
            label: 'OC Curve',
            data: data,
            borderColor: '#FF6B6B',
            borderWidth: 2,
            tension: 0.4,
            pointRadius: 0
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { labels: { font: { size: 10 } } }
          },
          scales: {
            x: {
              title: { 
                display: true, 
                text: 'Defect Rate (%)',
                font: { size: 10 }
              },
              ticks: { 
                font: { size: 8 },
                autoSkipPadding: 10
              }
            },
            y: { 
              title: { 
                display: true, 
                text: 'Acceptance Probability (Pa)',
                font: { size: 10 }
              },
              ticks: {
                font: { size: 8 },
                callback: value => (value*100).toFixed(0)+'%'
              },
              min: 0,
              max: 1
            }
          },
          layout: {
            padding: { left: 15, right: 15, top: 10, bottom: 15 }
          }
        }
      });
    };
    document.querySelectorAll('input[type="number"]').forEach(input => {
      input.addEventListener('input', updateChart);
    });
  </script>
</body>
</html>
